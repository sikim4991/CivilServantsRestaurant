# 공무원의 밥상

![Group 6](https://github.com/user-attachments/assets/fe5ce496-04a0-40c2-a932-cb132b063fa1)

<br>

## 소개

__지역 공무원들의 업무추진비 내역을 통해 맛집 찾는 법을 알고 계신가요?__

__그 중 서울특별시청의 업무추진비를 통한 맛집을 확인해보세요!__

__마음에 드는 장소를 즐겨찾기로 추가하고 관리할 수 있어요!__

- 개발 기간 : 2024.05 - 2024.07

- `Swift 5.10` `Xcode 15.4` `iOS 17.0`

- `Swift` `UIKit` `StoryBoard + CodeBase` `CocoaPods` `NaverMaps` `NaverSearchAPI` `OpenAPI` `SwiftSoup` `FileManager` `Git/GitHub` `Figma` 

<br>

## 주요 기능

- 서울특별시청의 업무추진비 데이터를 이용해 지도 상에서의 장소, 이름, 주소 등을 보여주는 앱입니다.

- 최대 250개의 최신 데이터를 요청하여 정보를 제공합니다.

- ( 하루에 모든 사용자가 25,000개의 검색량을 넘게 되면, 그 당일에 사용은 어려울 수 있습니다 )

- 지도를 통해 장소 위치 및 정보들을 확인할 수 있습니다.

- 지도에 표시된 장소들을 리스트로 확인할 수 있습니다.

- 카테고리를 눌러 분류된 장소들을 확인할 수 있습니다.

- 마음에 드는 장소(최대 50개)를 추가하고 관리할 수 있습니다.

## 구현 영상

|실행 첫화면|마커 선택 후 웹뷰 띄우기|'목록'에서 카테고리 선택, 해제 및 해당 장소 이동|
|:---:|:---:|:---:|
|![ezgif-6-22a26b2b34](https://github.com/user-attachments/assets/44286dd3-faf1-41de-92cb-61fde75badb9)|![ezgif-1-9f69398d1d](https://github.com/user-attachments/assets/aa3a811c-83bf-4104-bbed-6ad9129d87ed)|![ezgif-1-27a4c2860f](https://github.com/user-attachments/assets/6917cdde-a251-4db3-93de-ddd8c968a991)|
|장소이름 및 주소, 도로명 주소 공유|장소 즐겨찾기 추가(중복장소 방지)|즐겨찾기 확장셀 및 지도 이동|
|![ezgif-1-8b0d49a24d](https://github.com/user-attachments/assets/6b9787c2-65ae-4674-a92a-0f59089d72d7)|![ezgif-1-6fc9f2abce](https://github.com/user-attachments/assets/6e3826e0-5d78-4488-a50a-acb273d1783c)|![ezgif-4-67e063e2c7](https://github.com/user-attachments/assets/1955fede-d55a-4e4b-b5e8-5f8d3bc32438)|
|즐겨찾기에서 공유|즐겨찾기 삭제|데이터 불러오기|
|![ezgif-4-c13a9e9d9c](https://github.com/user-attachments/assets/fc79c68c-4ef3-401b-b788-9a2899aa6965)|![ezgif-4-0749cb3360](https://github.com/user-attachments/assets/a7aabd36-ad26-4916-9a3b-856d07eabb7e)|![ezgif-4-fdc7604671](https://github.com/user-attachments/assets/2a27eda3-9646-45f5-8bff-fea3da1f9277)|

<br>

## 이슈

### 지도 API 선택

 처음에는 API없이 라이브러리로 제공되는 애플의 Mapkit을 사용하려고 했다. 네이버, 구글, 카카오 등의 지도 API는 아무래도
요청을 받아오기때문에 제한되는 요소가 있을 것이고, 이는 불편함을 초래할 것 같았다. 그래서 Mapkit을 사용해보려고 테스트를 했는데 방법은 이러했다.

우선 업무추진비 API요청으로 받아온 집행장소를 애플 지도에 검색해서 마커로 표시되도록 하는 것인데, 테스트로 집행장소를 검색에 입력해보았다.
그러나 테스트 결과로 정확도는 좋지않았다. 몇 개의 장소는 검색이 되지않았다.

다른 앱들은 보통 어떤 걸 사용하는지 둘러보니 내가 본 앱들은 네이버 지도를 많이 썼다. 그래서 네이버 지도 API를 적용시켰다.
그런데 개발 중간에 안 사실은 네이버 지도 자체에 검색 기능은 존재하지 않았다. 네이버 장소 검색 API를 따로 이용해야했는데, 이걸로 봐선 검색은 네이버, 지도는 애플 Mapkit을 이용해도 됐을지도 모르겠다.

### API요청 시간

지도에 마커를 그리는 과정은 서울시본청 업무추진비 API요청 -> 네이버 검색 API요청(n번)한 데이터를 이용해 마커를 그린다.
업무추진비 API요청은 원하는 갯수를 지정해 한번에 여러개의 데이터를 가져올 수 있으나, 네이버 검색 API요청할 때는 여러개의 데이터를 한번에 요청하지 못한다.
1번에 1개의 검색어로만 요청할 수 있어 n개의 데이터 검색은 n번이나 요청해야한다. 여러번 요청할 때 일정개수 이상이 딜레이없이 요청하면 몇 개의 요청은 실패하여 데이터 소실이 있었다.
그리고 검색 API는 하루에 한도가 있어 적절한 데이터 갯수 조절이 필요했다.

이를 해결하기 위해 한번 데이터 불러올 때 50개로 지정했고, 검색 API요청 시에는 약간의 딜레이를 줘 데이터 소실이 없도록 했다.
그러나 불러올 때까지 기다리는 시간이 길어졌고 검색 API 하루 한도도 아직 해결되지 않았다.
여기서 생각해낸 것은 FileManager를 이용한 디스크 캐싱이였다. 검색 API요청 결과 데이터들을 디스크에 저장하여 캐시 데이터로 관리하는 방법으로 최신데이터인지, 디스크에 데이터 존재하는지 확인하여 불러오는 것이다.
이렇게 하면 네트워크를 통한 API요청보다 빠르게 불러올 수 있고, 요청 개수도 소모하지 않아 이론상으론 최대 100명이 최초 데이터 불러오기를 할 수 있는 것이다. (하루한도 25000번 / 데이터 50개 * 5번요청)

### Reject

1. 4.0.0 Design: Preamble

웹뷰를 네이버 지도에서 해당장소를 검색한 결과를 띄워서 제공했었다. 연결된 url은 모바일웹앱으로 네이버측에서 해당페이지 오른쪽 아래에 네이버 지도로 연결하는 버튼을 제공한다.
그런데 이부분이 리젝사유가 되었다. 지도로 연결하는 앱이 서드파티앱으로 제한하기 때문에 애플 지도에서 실행할 수 있도록 제공하라고 한다. 네이버에서 제공하는 버튼이라서 손쓸수 없었기에
이의신청을 해야하나 고민했었다. 그러다가 원래 웹뷰로 보여주려던 url로 방향을 바꾸자고 결심했다.

처음에는 왜 못했냐하면 url안의 path가 네이버측에서 따로 설정한 식별값이 들어가서였다. 이 식별값을 따로 제공해주지 않아서 네이버 지도 검색 결과를 띄웠었다.
그래서 리젝을 받은겸 원래 보여주려던 웹뷰로 바꿨다.
우선 네이버 검색 api를 통해 장소이름을 가져오기 때문에 네이버 지도 검색 결과 최상단의 장소가 원하는 정보가 담긴 장소였다.
이 최상단에 해당되는 코드안에 뭔가 힌트될만한게 있을 것 같아 '개발자 도구'를 통해 뜯어보았다. 웹에 대한 지식은 없지만 data id 라는 것이 식별값과 일치했고,
크롤링으로 이 값을 가져올 수 있을 것 같았다.

크롤링을 할 수 있는 SwiftSoup 프레임워크를 이용해 해당하는 url로 불러온 결과를 콘솔로 보니 개발자 도구에서 본 것과는 달랐다.
그래도 콘솔에는 js안에 식별값이 찍혀있어 일반적으로 크롤링하는 방법과 달리 문자열을 필터링하여 가져오게해 원하는 웹뷰를 띄울 수 있었다.

2. Guideline 4.2 - Design - Minimum Functionality

앱 심사 당시의 기능이 최소한의 기능을 미치지 못한다는 사유를 받았다. 이 사유가 가장 충격이였다. 애플측에서는 장소 데이터를 지도에 그려내는 것이 앱의 최소한의 기능을 하지 않는다고 봤나보다.
그래서 고민끝에 생각해낸 것이 가고싶은 장소나 갔다와서 마음에 드는 장소를 저장할 수 있는 '즐겨찾기'기능과, 다른 사람한테 주소를 쉽게 공유할 수 있도록 '공유하기'기능을 추가했다.
즐겨찾기는 탭을 새로 추가하여 TableView로 만들었으며, 장소와 카테고리를 보여주고 해당장소를 누르면 확장셀로 주소와 간단한 지도 등의 기능을 제공한다.
좀 더 넓은 지도에서 볼 수 있도록 지도탭으로 이동하는 기능도 있는데, 여기서는 마커를 달리해 다른 장소와 구분이 되게 했다.

3. Guideline 5.1.1 - Legal - Privacy - Data Collection and Storage

위치 권한 요청시에 안내문구에 대한 부분에서 리젝을 받았다. 첫 리젝을 받을 때는 테스트용으로 써놓은 '지도 권한 요청'을 수정하지 않았다.

뒤늦게 알아채 민망했지만 두번째는 '현재 사용자 위치를 나타내기 위해 위치 권한을 요청합니다.'라고 나름 제대로 적은 것 같은데 또 리젝을 받았다.

그래서 다른 앱들을 지웠다 받았다하며 위치 권한 요청 안내문을 참고해서 구체적인 이유를 적어냈더니 해결되었다.

<br>

## 아키텍처

__MVC(Model-View-ViewController)__ 디자인 패턴 적용
```
🗂CivilServantsRestaurant
 ┣ 🗂CivilServantsRestaurant
 ┃ ┣ 🗂Model
 ┃ ┣ 🗂View
 ┃ ┣ 🗂ViewControlelr
 ┃ ┗ 🗂Extension
 ┣ 🗂Product
 ┣ 🗂Pods
 ┗ 🗂Frameworks
🗂Pods
 ┣ 🗂Frameworks
 ┣ 🗂Pods
 ┣ 🗂Product
 ┗ 🗂Targets Support Files
```

## 회고

 앱스쿨 강의를 듣는동안 프레임워크 비중이 UIKit보단 SwiftUI가 컸기 때문에 UIKit 활용에 대한 자신감이 떨어져있었다.
 이전에 서적을 따라해보긴했지만, 전문적인 지식보단 흥미를 가지게 해주는? 느낌으로 서술되어있어 그 당시에도 Swift에 대해 좀 더 파고들고 싶었다.
 부트캠프 진행기간동안 Swift언어에 대해서는 충족되었지만 UIKit은 아직이라 생각하던 때에 '그래 한번 만들면서 배워보자!'하고 이 프로젝트를 시작했다.
 사실 정석처럼 UIKit에 대해 절차를 밟으며 공부해보고싶었는데 앱스쿨 실시간 강의와는 달리 문서나 글만 읽고 하려니까 지루한 느낌이 들었다.
 UIKit좀 하시는, 같이 수강했던 분들에게 UIKit공부 어떻게 하냐고 물었더니 프로젝트 하면서 공부했다고 입을 모아 말하더라.

 쨋든 이번 프로젝트를 통해서 UIKit에 대한 자신감이 상승했다.
 아예 앱을 만들어 보지도않고 '나중에 회사들어가서 상황되면 그래도 할 수 있겠지?'보단 만들어본 경험이 생겼으니 말이다.
 특히 View를 그릴 때 Storyboard랑 CodeBase(programmatic) 둘 다 사용해봤는데 CodeBase로 개발하는 것이 훨씬 편했다.
 많은 사람들이 이용하는데는 이유가 있다. CodeBase로도 더 편하게 해주는 Snapkit같은 프레임워크도 있던데 기회가 있으면 사용해봐야겠다.

 아쉬운 점이라면 제일 큰 건 역시 개발 기간일 것 같다. 프로젝트 중간에 개인적인 일들이 겹쳐서 중간에 공백기간이 있었다.
 그 공백기간이 없었더라면 뭔가 1달로 끝낼 수 있지 않았을까 싶기도하다.
 그리고 처음 reject을 받아본 프로젝트다. 생각보다 리젝 사유가 심각?해 개발 기간이 길어지기도 했다.
 앱이 최소한의 기능에 충족하지 않는다는 사유는 좀 충격이였고 슬펐다. 이 사유때문에 기능을 추가하느라,,

 이번 경험을 통하여 전체적으로 발전했겠지만, 특히 UIKit에 대한 전반적인 이해와 아키텍처(MVC), 그리고 앱 기획/개발에 대해 조금 더 발전한 느낌이 든다.
 다음 프로젝트는 좀 더 집중할 수 있는 환경에서 진행했으면 좋겠고, 개발에 있어서 시행착오는 뗄래야 뗄 수 없는 관계인 것 같다.
 정보를 찾아보는 것도 그렇고, 여러 번 벽에 부딫치고 헛고생도 해보고 하는 과정은 완벽함보다는 다음에 실패를 줄이기 위한 과정인 것 같다.
